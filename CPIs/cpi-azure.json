{
    "name": "azure",
    "type": "command",
    "default_settings": {
      "location": "eastus",
      "resource_group": "default-rg",
      "vm_size": "Standard_B1s",
      "image": "Canonical:UbuntuServer:18.04-LTS:latest",
      "admin_username": "azureuser",
      "disk_sku": "Standard_LRS"
    },
    "actions": {
      "test_install": {
        "command": "az --version",
        "params": [],
        "parse_rules": {
          "type": "object",
          "patterns": {
            "version": {
              "regex": "azure-cli\\s+([\\d\\.]+)",
              "group": 1
            }
          }
        }
      },
      "create_resource_group": {
        "command": "az group create --name {resource_group} --location {location}",
        "params": [
          "resource_group",
          "location"
        ],
        "parse_rules": {
          "type": "object",
          "patterns": {
            "name": {
              "regex": "\"name\":\\s*\"([^\"]+)\"",
              "group": 1
            },
            "location": {
              "regex": "\"location\":\\s*\"([^\"]+)\"",
              "group": 1
            }
          }
        }
      },
      "delete_resource_group": {
        "command": "az group delete --name {resource_group} --yes --no-wait",
        "params": [
          "resource_group"
        ],
        "parse_rules": {
          "type": "object",
          "patterns": {
            "success": {
              "regex": ".*",
              "transform": "boolean"
            }
          }
        }
      },
      "create_worker": {
        "command": "az vm create --resource-group {resource_group} --name {vm_name} --image {image} --admin-username {admin_username} --size {vm_size} --generate-ssh-keys",
        "params": [
          "resource_group",
          "vm_name",
          "image",
          "admin_username",
          "vm_size"
        ],
        "parse_rules": {
          "type": "object",
          "patterns": {
            "id": {
              "regex": "\"id\":\\s*\"([^\"]+)\"",
              "group": 1
            },
            "public_ip": {
              "regex": "\"publicIpAddress\":\\s*\"([^\"]+)\"",
              "group": 1,
              "optional": true
            },
            "private_ip": {
              "regex": "\"privateIpAddress\":\\s*\"([^\"]+)\"",
              "group": 1
            }
          }
        }
      },
      "delete_worker": {
        "command": "az vm delete --resource-group {resource_group} --name {vm_name} --yes",
        "params": [
          "resource_group",
          "vm_name"
        ],
        "parse_rules": {
          "type": "object",
          "patterns": {
            "success": {
              "regex": ".*",
              "transform": "boolean"
            }
          }
        }
      },
      "start_worker": {
        "command": "az vm start --resource-group {resource_group} --name {vm_name}",
        "params": [
          "resource_group",
          "vm_name"
        ],
        "parse_rules": {
          "type": "object",
          "patterns": {
            "success": {
              "regex": ".*",
              "transform": "boolean"
            }
          }
        }
      },
      "stop_worker": {
        "command": "az vm stop --resource-group {resource_group} --name {vm_name}",
        "params": [
          "resource_group",
          "vm_name"
        ],
        "parse_rules": {
          "type": "object",
          "patterns": {
            "success": {
              "regex": ".*",
              "transform": "boolean"
            }
          }
        }
      },
      "list_workers": {
        "command": "az vm list --resource-group {resource_group}",
        "params": [
          "resource_group"
        ],
        "parse_rules": {
          "type": "array",
          "separator": "\"name\"",
          "patterns": {
            "name": {
              "regex": "\"name\":\\s*\"([^\"]+)\"",
              "group": 1
            },
            "id": {
              "regex": "\"id\":\\s*\"([^\"]+)\"",
              "group": 1
            },
            "status": {
              "regex": "\"powerState\":\\s*\"([^\"]+)\"",
              "group": 1,
              "optional": true
            },
            "size": {
              "regex": "\"vmSize\":\\s*\"([^\"]+)\"",
              "group": 1
            }
          }
        }
      },
      "get_worker": {
        "command": "az vm show --resource-group {resource_group} --name {vm_name}",
        "params": [
          "resource_group",
          "vm_name"
        ],
        "parse_rules": {
          "type": "properties",
          "patterns": {
            "id": {
              "regex": "\"id\":\\s*\"([^\"]+)\"",
              "group": 1
            },
            "name": {
              "regex": "\"name\":\\s*\"([^\"]+)\"",
              "group": 1
            },
            "location": {
              "regex": "\"location\":\\s*\"([^\"]+)\"",
              "group": 1
            },
            "size": {
              "regex": "\"hardwareProfile\":\\s*\\{[^}]*\"vmSize\":\\s*\"([^\"]+)\"",
              "group": 1
            },
            "os_volume": {
              "regex": "\"osProfileWindowsConfiguration\":\\s*\\{",
              "transform": "boolean",
              "optional": true
            }
          }
        }
      },
      "create_volume": {
        "command": "az disk create --resource-group {resource_group} --name {disk_name} --size-gb {size_gb} --sku {disk_sku}",
        "params": [
          "resource_group",
          "disk_name",
          "size_gb",
          "disk_sku"
        ],
        "parse_rules": {
          "type": "object",
          "patterns": {
            "id": {
              "regex": "\"id\":\\s*\"([^\"]+)\"",
              "group": 1
            },
            "name": {
              "regex": "\"name\":\\s*\"([^\"]+)\"",
              "group": 1
            }
          }
        }
      },
      "attach_volume": {
        "command": "az vm disk attach --resource-group {resource_group} --vm-name {vm_name} --name {disk_name}",
        "params": [
          "resource_group",
          "vm_name",
          "disk_name"
        ],
        "parse_rules": {
          "type": "object",
          "patterns": {
            "success": {
              "regex": ".*",
              "transform": "boolean"
            }
          }
        }
      },
      "detach_volume": {
        "command": "az vm disk detach --resource-group {resource_group} --vm-name {vm_name} --name {disk_name}",
        "params": [
          "resource_group",
          "vm_name",
          "disk_name"
        ],
        "parse_rules": {
          "type": "object",
          "patterns": {
            "success": {
              "regex": ".*",
              "transform": "boolean"
            }
          }
        }
      },
      "list_volumes": {
        "command": "az disk list --resource-group {resource_group}",
        "params": [
          "resource_group"
        ],
        "parse_rules": {
          "type": "array",
          "separator": "\"name\"",
          "patterns": {
            "name": {
              "regex": "\"name\":\\s*\"([^\"]+)\"",
              "group": 1
            },
            "id": {
              "regex": "\"id\":\\s*\"([^\"]+)\"",
              "group": 1
            },
            "size_gb": {
              "regex": "\"diskSizeGb\":\\s*(\\d+)",
              "group": 1,
              "transform": "number"
            },
            "sku": {
              "regex": "\"sku\":\\s*\\{[^}]*\"name\":\\s*\"([^\"]+)\"",
              "group": 1
            }
          }
        }
      },
      "has_volume": {
        "command": "az disk show --resource-group {resource_group} --name {disk_name}",
        "params": [
          "resource_group",
          "disk_name"
        ],
        "parse_rules": {
          "type": "object",
          "patterns": {
            "exists": {
              "regex": "\"name\"",
              "transform": "boolean"
            }
          }
        }
      },
      "create_snapshot": {
        "command": "az snapshot create --resource-group {resource_group} --name {snapshot_name} --source {disk_id}",
        "params": [
          "resource_group",
          "snapshot_name",
          "disk_id"
        ],
        "parse_rules": {
          "type": "object",
          "patterns": {
            "id": {
              "regex": "\"id\":\\s*\"([^\"]+)\"",
              "group": 1
            },
            "name": {
              "regex": "\"name\":\\s*\"([^\"]+)\"",
              "group": 1
            }
          }
        }
      }
    }
  }